import React, { useState, useEffect, useRef } from 'react';
import ModalMember from './ModalMember';

const ModalOne: React.FC<{onNext: () => void}> = ({onNext}) => {
  const [modalOpen, setModalOpen] = useState(false);

  const trigger = useRef<any>(null);
  const modal = useRef<any>(null);

  // close on click outside
  useEffect(() => {
    const clickHandler = ({ target }: MouseEvent) => {
      if (!modal.current) return;
      if (
        !modalOpen ||
        modal.current.contains(target) ||
        trigger.current.contains(target)
      )
        return;
      setModalOpen(false);
    };
    document.addEventListener('click', clickHandler);
    return () => document.removeEventListener('click', clickHandler);
  });

  // close if the esc key is pressed
  useEffect(() => {
    const keyHandler = ({ keyCode }: KeyboardEvent) => {
      if (!modalOpen || keyCode !== 27) return;
      setModalOpen(false);
    };
    document.addEventListener('keydown', keyHandler);
    return () => document.removeEventListener('keydown', keyHandler);
  });

  return (
    <div>
      <button
        ref={trigger}
        onClick={() => setModalOpen(!modalOpen)}
        className="flex items-center hover:bg-opacity-90"
      >
        <svg width="22" height="22" viewBox="0 0 22 22" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path d="M21.3487 8.75622C20.9869 8.35489 20.4803 8.13599 19.9376 8.13599H19.8291C19.6481 8.13599 19.5034 8.02653 19.4672 7.8806C19.431 7.73466 19.3587 7.62521 19.3225 7.47927C19.2501 7.33333 19.3225 7.1874 19.431 7.07794L19.5034 7.00498C19.9014 6.64013 20.1185 6.12935 20.1185 5.58209C20.1185 5.03483 19.9376 4.52405 19.5396 4.12272L18.1285 2.66335C17.3686 1.8607 16.0661 1.82421 15.2701 2.62687L15.1615 2.69983C15.053 2.80929 14.8721 2.84577 14.6911 2.7728C14.5464 2.69983 14.4017 2.62687 14.2208 2.59038C14.0399 2.51741 13.9313 2.37148 13.9313 2.22554V2.04312C13.9313 0.912106 13.0267 0 11.9051 0H9.87887C9.33613 0 8.82958 0.218906 8.46775 0.583748C8.06974 0.985075 7.88883 1.49585 7.88883 2.00663V2.15257C7.88883 2.29851 7.78028 2.44444 7.63555 2.51741C7.56319 2.5539 7.52701 2.5539 7.45464 2.59038C7.30991 2.66335 7.129 2.62687 7.02045 2.51741L6.94809 2.40796C6.58626 2.00663 6.07971 1.78773 5.53697 1.78773C4.99423 1.78773 4.48768 1.97015 4.08967 2.37148L2.64237 3.79436C1.84636 4.56053 1.81017 5.87396 2.60619 6.67662L2.67855 6.78607C2.7871 6.89552 2.82328 7.07794 2.75092 7.1874C2.67855 7.33333 2.64237 7.44279 2.57001 7.58872C2.49764 7.73466 2.38909 7.80763 2.20818 7.80763H2.09963C1.5569 7.80763 1.05034 7.99005 0.652334 8.39138C0.254326 8.75622 0.0372314 9.267 0.0372314 9.81426L0.00104893 11.8574C-0.0351336 12.9884 0.869429 13.9005 1.99109 13.937H2.09963C2.28055 13.937 2.42528 14.0464 2.46146 14.1924C2.53382 14.3018 2.60619 14.4113 2.64237 14.5572C2.67855 14.7032 2.64237 14.8491 2.53382 14.9585L2.46146 15.0315C2.06345 15.3964 1.84636 15.9071 1.84636 16.4544C1.84636 17.0017 2.02727 17.5124 2.42528 17.9138L3.83639 19.3731C4.59622 20.1758 5.89879 20.2123 6.69481 19.4096L6.80336 19.3366C6.9119 19.2272 7.09282 19.1907 7.27373 19.2637C7.41846 19.3366 7.56319 19.4096 7.7441 19.4461C7.92501 19.5191 8.03356 19.665 8.03356 19.8109V19.9569C8.03356 21.0879 8.93812 22 10.0598 22H12.086C13.2077 22 14.1122 21.0879 14.1122 19.9569V19.8109C14.1122 19.665 14.2208 19.5191 14.3655 19.4461C14.4379 19.4096 14.474 19.4096 14.5464 19.3731C14.7273 19.3002 14.8721 19.3366 14.9806 19.4461L15.053 19.5556C15.4148 19.9569 15.9213 20.1758 16.4641 20.1758C17.0068 20.1758 17.5134 19.9934 17.9114 19.592L19.3587 18.1692C20.1547 17.403 20.1909 16.0896 19.3949 15.2869L19.3225 15.1774C19.2139 15.068 19.1778 14.8856 19.2501 14.7761C19.3225 14.6302 19.3587 14.5207 19.431 14.3748C19.5034 14.2289 19.6481 14.1559 19.7929 14.1559H19.9014H19.9376C21.0231 14.1559 21.9276 13.2803 21.9638 12.1493L22 10.1061C21.9276 9.66833 21.7105 9.12106 21.3487 8.75622ZM20.2632 12.1857C20.2632 12.4046 20.0823 12.5871 19.8652 12.5871H19.7567H19.7205C18.8883 12.5871 18.1285 13.0978 17.839 13.8275C17.8028 13.937 17.7305 14.0464 17.6943 14.1559C17.3686 14.8856 17.5134 15.7977 18.0923 16.3814L18.1647 16.4909C18.3094 16.6368 18.3094 16.8922 18.1647 17.0381L16.7174 18.461C16.6088 18.5705 16.5003 18.5705 16.4279 18.5705C16.3555 18.5705 16.247 18.5705 16.1384 18.461L16.0661 18.3516C15.4872 17.7313 14.6188 17.5489 13.8228 17.9138L13.678 17.9867C12.882 18.3151 12.3755 19.0448 12.3755 19.8839V20.0299C12.3755 20.2488 12.1945 20.4312 11.9775 20.4312H9.95123C9.73414 20.4312 9.55323 20.2488 9.55323 20.0299V19.8839C9.55323 19.0448 9.04667 18.2786 8.25066 17.9867C8.14211 17.9502 7.99738 17.8773 7.88883 17.8408C7.59937 17.6949 7.30991 17.6584 7.02045 17.6584C6.5139 17.6584 6.00734 17.8408 5.60933 18.2421L5.53697 18.2786C5.39224 18.4245 5.13896 18.4245 4.99423 18.2786L3.58312 16.8192C3.47457 16.7098 3.47457 16.6003 3.47457 16.5274C3.47457 16.4544 3.47457 16.3449 3.58312 16.2355L3.65548 16.1625C4.27058 15.5788 4.4515 14.6667 4.12585 13.937C4.08967 13.8275 4.05349 13.7181 3.98112 13.6086C3.69166 12.8425 2.96801 12.2952 2.13582 12.2952H2.02727C1.81017 12.2952 1.62926 12.1128 1.62926 11.8939L1.66544 9.85075C1.66544 9.70481 1.73781 9.63184 1.77399 9.55887C1.81017 9.52239 1.91872 9.44942 2.06345 9.44942H2.172C3.0042 9.4859 3.76403 8.97512 4.08967 8.20895C4.12585 8.0995 4.19822 7.99005 4.2344 7.8806C4.56004 7.15091 4.41531 6.23881 3.83639 5.65506L3.76403 5.54561C3.6193 5.39967 3.6193 5.14428 3.76403 4.99834L5.21133 3.57546C5.31987 3.466 5.42842 3.466 5.50079 3.466C5.57315 3.466 5.6817 3.466 5.79025 3.57546L5.86261 3.68491C6.44153 4.30514 7.30991 4.48756 8.10593 4.1592L8.25066 4.08624C9.04667 3.75788 9.55323 3.02819 9.55323 2.18905V2.04312C9.55323 1.89718 9.62559 1.82421 9.66177 1.75124C9.69796 1.67828 9.8065 1.64179 9.95123 1.64179H11.9775C12.1945 1.64179 12.3755 1.82421 12.3755 2.04312V2.18905C12.3755 3.02819 12.882 3.79436 13.678 4.08624C13.7866 4.12272 13.9313 4.19569 14.0399 4.23217C14.7997 4.59701 15.7042 4.45108 16.3193 3.86733L16.4279 3.79436C16.5726 3.64842 16.8259 3.64842 16.9706 3.79436L18.3818 5.25373C18.4903 5.36318 18.4903 5.47264 18.4903 5.54561C18.4903 5.61857 18.4541 5.72803 18.3818 5.83748L18.3094 5.91045C17.6581 6.45771 17.4772 7.36982 17.7666 8.0995C17.8028 8.20895 17.839 8.31841 17.9114 8.42786C18.2008 9.19403 18.9245 9.74129 19.7567 9.74129H19.8652C20.01 9.74129 20.0823 9.81426 20.1547 9.85075C20.2271 9.88723 20.2632 9.99668 20.2632 10.1426V12.1857Z" fill="#999999"/>
        <path d="M10.9648 6.05664C8.25108 6.05664 6.04395 8.28218 6.04395 11.0185C6.04395 13.7548 8.25108 15.9804 10.9648 15.9804C13.6785 15.9804 15.8856 13.7548 15.8856 11.0185C15.8856 8.28218 13.6785 6.05664 10.9648 6.05664ZM10.9648 14.3386C9.15564 14.3386 7.67216 12.8427 7.67216 11.0185C7.67216 9.19429 9.15564 7.69843 10.9648 7.69843C12.7739 7.69843 14.2574 9.19429 14.2574 11.0185C14.2574 12.8427 12.7739 14.3386 10.9648 14.3386Z" fill="#999999"/>
        </svg>
      </button>
      <div
        className={`fixed left-0 top-0 z-999999 flex h-full min-h-screen w-full items-center justify-center bg-black/90 px-4 py-5 ${
          modalOpen ? 'block' : 'hidden'
        }`}
      >
        <div
          ref={modal}
          onFocus={() => setModalOpen(true)}
          onBlur={() => setModalOpen(false)}
          className="relative md:px-9 w-full max-w-lg rounded-lg bg-white px-8 py-12 text-center dark:bg-boxdark md:pt-16 md:pb-10"
        >
           <button
            onClick={() => setModalOpen(false)}
            className="absolute top-4 right-4"
          >
          <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M11 10L18.625 2.375C18.9062 2.09375 18.9062 1.65625 18.625 1.375C18.3438 1.09375 17.9062 1.09375 17.625 1.375L10 9L2.375 1.375C2.09375 1.09375 1.65625 1.09375 1.375 1.375C1.09375 1.65625 1.09375 2.09375 1.375 2.375L9 10L1.375 17.625C1.09375 17.9062 1.09375 18.3438 1.375 18.625C1.5 18.75 1.6875 18.8438 1.875 18.8438C2.0625 18.8438 2.25 18.7812 2.375 18.625L10 11L17.625 18.625C17.75 18.75 17.9375 18.8438 18.125 18.8438C18.3125 18.8438 18.5 18.7812 18.625 18.625C18.9062 18.3438 18.9062 17.9062 18.625 17.625L11 10Z" fill="#666666"/>
          </svg>
          </button>

          <h3 className="pb-10 text-xl font-bold text-black dark:text-white sm:text-2xl">
            회원정보 수정하기
          </h3>

              <div className="mb-2">
                <label className="mb-2 block font-bold text-md text-black text-left dark:text-white">
                  비밀번호
                </label>
                <div className="relative">
                  <input
                    type="password"
                    placeholder="가입하실 떄 설정한 비밀번호를 입력하세요"
                    className="w-full rounded-lg border border-borgray bg-transparent py-[7px] pl-6 pr-10 text-black outline-none focus:border-graydark focus-visible:shadow-none dark:border-form-strokedark dark:bg-form-input dark:text-white dark:focus:border-primary"
                  />

                  <span className="absolute inset-y-0 right-4 flex items-center pointer-events-none">
                    <svg width="25" height="21" viewBox="0 0 25 21" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M12.223 16.9824C4.89481 16.9824 1.26774 11.0762 1.1197 10.8262C1.00866 10.6387 1.00866 10.3887 1.1197 10.2012C1.26774 9.95117 4.89481 4.07617 12.223 4.07617C19.5511 4.07617 23.1782 9.95117 23.3262 10.2012C23.4373 10.3887 23.4373 10.6387 23.3262 10.8262C23.1782 11.0762 19.5511 16.9824 12.223 16.9824ZM2.8222 10.5137C3.63644 11.6699 6.81937 15.5762 12.223 15.5762C17.6265 15.5762 20.8095 11.6699 21.6237 10.5137C20.8095 9.35742 17.6265 5.45117 12.223 5.45117C6.81937 5.45117 3.63644 9.35742 2.8222 10.5137Z" fill="#999999"/>
                    <path d="M12.223 13.1699C10.4834 13.1699 9.07703 11.9824 9.07703 10.5137C9.07703 9.04492 10.4834 7.85742 12.223 7.85742C13.9625 7.85742 15.3689 9.04492 15.3689 10.5137C15.3689 11.9824 13.9625 13.1699 12.223 13.1699ZM12.223 9.26367C11.4087 9.26367 10.7425 9.82617 10.7425 10.5137C10.7425 11.2012 11.4087 11.7637 12.223 11.7637C13.0372 11.7637 13.7034 11.2012 13.7034 10.5137C13.7034 9.82617 13.0372 9.26367 12.223 9.26367Z" fill="#999999"/>
                    </svg>
                  </span>
                  
                </div>
                <div className='text-left mt-2'>
                  <p className="text-xs text-subgray dark:text-gray-400 mt-1">
                  ※ 개인정보를 보호하기 위해 비밀번호를 다시 한 번 확인합니다.
                  </p>
                  <p className="text-xs text-subgray dark:text-gray-400 mt-1">
                  ※ 타인에게 회원님의 비밀번호가 노출되지 않도록 주의해 주세요.
                  </p>
                </div>

              </div>


          <div className="mx-6 mt-6 flex flex-wrap">
            <div className="2xsm:w-1/2 w-full px-3">
              <button
                onClick={() => setModalOpen(false)}
                className="block w-full rounded-full border border-white bg-butgray p-[9px] text-sm text-center font-medium text-black transition hover:bg-gray">
                뒤로가기
              </button>
            </div>
            <div className="2xsm:w-1/2 w-full px-3">
              <button className="block w-full rounded-full border border-black bg-black p-[9px] text-sm text-center font-medium text-white transition hover:bg-opacity-90"
              onClick={onNext}>
              수정하기
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
  );
};

export default ModalOne;
